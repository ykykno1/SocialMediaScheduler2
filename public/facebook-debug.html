<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facebook Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .debug-info {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #2196F3;
        }
        .error { border-left-color: #f44336; }
        .success { border-left-color: #4CAF50; }
        .warning { border-left-color: #FF9800; }
        pre {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
            font-size: 12px;
        }
        button {
            background: #1877f2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #166fe5; }
    </style>
</head>
<body>
    <h2>Facebook OAuth Debug Tool</h2>
    
    <div class="debug-info">
        <h3>Debug Information</h3>
        <div id="debug-info">Loading...</div>
    </div>
    
    <button onclick="testDirectFacebookURL()">פתח Facebook URL ישירות</button>
    <button onclick="testProductionCallback()">בדוק production callback</button>
    <button onclick="checkFacebookApp()">בדוק Facebook App Status</button>
    
    <div id="results"></div>
    
    <script>
        function addResult(title, content, type = 'info') {
            const div = document.createElement('div');
            div.className = `debug-info ${type}`;
            div.innerHTML = `<h4>${title}</h4><pre>${JSON.stringify(content, null, 2)}</pre>`;
            document.getElementById('results').appendChild(div);
        }
        
        // Show initial debug info
        document.getElementById('debug-info').innerHTML = `
            <strong>Current URL:</strong> ${window.location.href}<br>
            <strong>Origin:</strong> ${window.location.origin}<br>
            <strong>Host:</strong> ${window.location.host}<br>
            <strong>Protocol:</strong> ${window.location.protocol}<br>
            <strong>User Agent:</strong> ${navigator.userAgent}<br>
        `;
        
        function testDirectFacebookURL() {
            const fbURL = "https://www.facebook.com/v22.0/dialog/oauth?" +
                "client_id=1598261231562840&" +
                "redirect_uri=" + encodeURIComponent("https://social-media-scheduler-ykykyair.replit.app/auth-callback.html") + "&" +
                "scope=email,public_profile,user_posts,user_photos&" +
                "response_type=code&" +
                "state=DEBUG_TEST_" + Date.now();
            
            addResult("Facebook URL Test", {
                url: fbURL,
                action: "Opening in new window"
            });
            
            window.open(fbURL, 'facebook-debug', 'width=600,height=700');
        }
        
        async function testProductionCallback() {
            try {
                const response = await fetch('https://social-media-scheduler-ykykyair.replit.app/auth-callback.html');
                const text = await response.text();
                
                addResult("Production Callback Test", {
                    status: response.status,
                    ok: response.ok,
                    contentLength: text.length,
                    contentPreview: text.substring(0, 200) + "..."
                }, response.ok ? 'success' : 'error');
            } catch (error) {
                addResult("Production Callback Test", {
                    error: error.message
                }, 'error');
            }
        }
        
        async function checkFacebookApp() {
            try {
                // Check if we can reach Facebook's API
                const testURL = "https://graph.facebook.com/v22.0/1598261231562840";
                const response = await fetch(testURL);
                const data = await response.json();
                
                addResult("Facebook App Check", {
                    status: response.status,
                    data: data
                }, response.ok ? 'success' : 'warning');
            } catch (error) {
                addResult("Facebook App Check", {
                    error: error.message
                }, 'error');
            }
        }
        
        // Auto-check production callback on load
        setTimeout(testProductionCallback, 1000);
    </script>
</body>
</html>