<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facebook Debug Simple</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test { margin: 15px 0; padding: 10px; border: 1px solid #ccc; }
        button { background: #1877f2; color: white; border: none; padding: 10px 15px; margin: 5px; cursor: pointer; }
        .result { margin-top: 10px; padding: 10px; background: #f9f9f9; }
    </style>
</head>
<body>
    <h2>Facebook OAuth Debug - Simple Test</h2>
    
    <div class="test">
        <h4>拽 1: 驻转转 Facebook OAuth URL 砖专转</h4>
        <button onclick="testDirectFacebookURL()">驻转 Facebook OAuth 砖专转</button>
        <div id="result1" class="result"></div>
    </div>
    
    <div class="test">
        <h4>拽 2: 拽转 auth-callback.html</h4>
        <button onclick="testAuthCallback()">拽 auth-callback.html</button>
        <div id="result2" class="result"></div>
    </div>
    
    <div class="test">
        <h4>拽 3: 驻转转 popup 注 debug</h4>
        <button onclick="testPopupWithDebug()">驻转 popup 注 debug</button>
        <div id="result3" class="result"></div>
    </div>

    <script>
        function testDirectFacebookURL() {
            const redirectUri = window.location.origin + '/auth-callback.html';
            const fbURL = `https://www.facebook.com/v22.0/dialog/oauth?` +
                `client_id=1598261231562840&` +
                `redirect_uri=${encodeURIComponent(redirectUri)}&` +
                `scope=email,public_profile&` +
                `response_type=code&` +
                `state=DIRECT_TEST_${Date.now()}`;
            
            document.getElementById('result1').innerHTML = `
                <strong>驻 驻住拽:</strong><br>
                <code>${fbURL}</code><br>
                <strong>Redirect URI:</strong> ${redirectUri}
            `;
            
            window.open(fbURL, '_blank');
        }
        
        function testAuthCallback() {
            const callbackUrl = window.location.origin + '/auth-callback.html?test=true';
            
            document.getElementById('result2').innerHTML = `
                <strong>拽:</strong> ${callbackUrl}
            `;
            
            window.open(callbackUrl, '_blank');
        }
        
        function testPopupWithDebug() {
            const redirectUri = window.location.origin + '/auth-callback.html';
            const fbURL = `https://www.facebook.com/v22.0/dialog/oauth?` +
                `client_id=1598261231562840&` +
                `redirect_uri=${encodeURIComponent(redirectUri)}&` +
                `scope=email,public_profile&` +
                `response_type=code&` +
                `state=POPUP_TEST_${Date.now()}`;
            
            const result3 = document.getElementById('result3');
            result3.innerHTML = `
                <strong>驻转 popup...</strong><br>
                URL: <code>${fbURL}</code>
            `;
            
            const popup = window.open(fbURL, 'facebook-test', 'width=600,height=700');
            
            if (!popup) {
                result3.innerHTML += '<br><strong style="color: red;">Popup 住!</strong>';
                return;
            }
            
            let checkCount = 0;
            const checkInterval = setInterval(() => {
                checkCount++;
                result3.innerHTML = `
                    <strong>驻转 popup... (${checkCount} 砖转)</strong><br>
                    URL: <code>${fbURL}</code><br>
                    Popup status: ${popup.closed ? '住专' : '驻转'}
                `;
                
                if (popup.closed) {
                    clearInterval(checkInterval);
                    result3.innerHTML += '<br><strong>Popup 住专</strong>';
                }
                
                if (checkCount > 60) { // 60 seconds timeout
                    clearInterval(checkInterval);
                    popup.close();
                    result3.innerHTML += '<br><strong> 拽爪</strong>';
                }
            }, 1000);
        }
        
        // Listen for messages from auth-callback
        window.addEventListener('message', (event) => {
            console.log(' Message received:', event.data);
            
            if (event.data.type === 'FACEBOOK_AUTH_SUCCESS' || event.data.type === 'FACEBOOK_AUTH_ERROR') {
                const results = document.querySelectorAll('.result');
                results.forEach(result => {
                    result.innerHTML += `<br><strong>注 popup:</strong> ${JSON.stringify(event.data)}`;
                });
            }
        });
    </script>
</body>
</html>