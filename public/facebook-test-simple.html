<!DOCTYPE html>
<html>
<head>
    <title>Facebook Test Simple</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial; padding: 20px; }
        button { padding: 10px 20px; margin: 10px; background: #1877f2; color: white; border: none; cursor: pointer; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; font-family: monospace; }
    </style>
</head>
<body>
    <h1>Facebook OAuth Test - Simple</h1>
    
    <button onclick="testDirectFacebook()">Test Direct Facebook</button>
    <button onclick="testAuthCallback()">Test Auth Callback</button>
    <button onclick="clearLogs()">Clear</button>
    
    <div id="logs"></div>

    <script>
        function log(msg) {
            const div = document.createElement('div');
            div.className = 'log';
            div.textContent = new Date().toLocaleTimeString() + ': ' + msg;
            document.getElementById('logs').appendChild(div);
            console.log(msg);
        }
        
        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }
        
        function testAuthCallback() {
            log('Testing auth-callback.html directly...');
            const testUrl = '/auth-callback.html?test=true&code=TEST123&state=TEST_STATE';
            window.open(testUrl, 'test-callback', 'width=500,height=400');
        }
        
        function testDirectFacebook() {
            log('Testing direct Facebook OAuth...');
            
            const domain = window.location.host;
            const redirectUri = `https://${domain}/auth-callback.html`;
            
            const fbUrl = `https://www.facebook.com/v22.0/dialog/oauth?` +
                `client_id=1598261231562840&` +
                `redirect_uri=${encodeURIComponent(redirectUri)}&` +
                `scope=email,public_profile&` +
                `response_type=code&` +
                `state=SIMPLE_TEST_${Date.now()}`;
            
            log('Redirect URI: ' + redirectUri);
            log('Opening: ' + fbUrl);
            
            const popup = window.open(fbUrl, 'fb-test', 'width=600,height=700');
            
            // Monitor popup
            let checkCount = 0;
            const interval = setInterval(() => {
                checkCount++;
                
                if (popup.closed) {
                    clearInterval(interval);
                    log(`Popup closed after ${checkCount} seconds`);
                    return;
                }
                
                try {
                    const url = popup.location.href;
                    if (url.includes('auth-callback.html')) {
                        log('SUCCESS: Redirected to auth-callback.html');
                        clearInterval(interval);
                    }
                } catch (e) {
                    // CORS expected on Facebook domain
                }
                
                if (checkCount > 30) {
                    clearInterval(interval);
                    popup.close();
                    log('Timeout - closing popup');
                }
            }, 1000);
        }
        
        // Listen for messages from auth-callback
        window.addEventListener('message', (event) => {
            log('Message received: ' + JSON.stringify(event.data));
        });
    </script>
</body>
</html>