
Performance indexes ready
Stripe Demo initialized (DEMO MODE)
Registering Stripe Demo routes...
Demo: Reset trial status and subscription for legacy user phtLx68scJszZOMrBEPHL
Reset trial status for legacy user phtLx68scJszZOMrBEPHL
✅ Stripe Demo routes registered successfully
🤖 Starting automatic scheduler on server startup...
🚀 Starting Automatic Shabbat Content Scheduler...
📋 Found 5 total users
👑 Found 2 premium users
⚠️ No Shabbat times found for user yy@gmail.com
🌍 Fetching Shabbat times for תל אביב (531) using HebCal API (fallback)
📡 Calling HebCal API: https://www.hebcal.com/shabbat?cfg=json&geonameid=293397&date=2025-07-18
Database migration status: {
  secure_users: '5',
  encrypted_auth_tokens: '1',
  video_lock_statuses: '5',
  video_statuses: '1'
}
Enhanced storage ready
✅ Got HebCal times for תל אביב: Entry 16:28, Exit 17:27
⏰ User yk@gmail.com scheduling:
        🕯️ Shabbat entry: 18.7.2025, 16:28:00
        ✨ Shabbat exit: 19.7.2025, 17:27:00
        📱 Hide preference: 15min → Hide at: 18.7.2025, 16:13:00
        🔓 Restore preference: 30min → Restore at: 19.7.2025, 17:57:00
📅 Scheduling cron job for: 18.7.2025, 16:13:00 (16:13)
⏱️ Creating cron job for 18.7.2025, 16:13:00 with pattern: 13 16 18 7 *
📅 Scheduling cron job for: 19.7.2025, 17:57:00 (17:57)
⏱️ Creating cron job for 19.7.2025, 17:57:00 with pattern: 57 17 19 7 *
✅ Scheduled 2 operations for yk@gmail.com
✅ Scheduled jobs for 2 premium users
✅ Automatic Scheduler started successfully
🤖 Automatic scheduler started successfully
7:57:47 PM [express] serving on port 5000
Browserslist: browsers data (caniuse-lite) is 9 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
7:57:53 PM [express] GET /api/user 401 in 3ms :: {"error":"Not authenticated"}
Raw secureUser from database: {
  id: 'phtLx68scJszZOMrBEPHL',
  email: 'yk@gmail.com',
  username: 'yk',
  passwordHash: '$2b$10$3EObo0LMRb0iu3/HAfCCOOXACLmDeU9wFIknjnRc/SRWzf8Q8fq7a',
  accountTier: 'premium',
  emailVerified: true,
  isActive: true,
  phoneNumber: null,
  phoneVerified: false,
  registrationMethod: 'email',
  shabbatCity: 'תל אביב',
  shabbatCityId: '531',
  hideTimingPreference: '15min',
  restoreTimingPreference: '30min',
  createdAt: 2025-06-10T01:25:14.797Z,
  updatedAt: 2025-07-12T18:32:09.338Z,
  lastLogin: 2025-06-27T12:09:46.135Z
}
Timing preferences from DB: { hideTimingPreference: '15min', restoreTimingPreference: '30min' }
Full user from database: {
  id: 'phtLx68scJszZOMrBEPHL',
  email: 'yk@gmail.com',
  username: 'yk',
  password: '$2b$10$3EObo0LMRb0iu3/HAfCCOOXACLmDeU9wFIknjnRc/SRWzf8Q8fq7a',
  accountType: 'premium',
  shabbatCity: 'תל אביב',
  shabbatCityId: '531',
  hideTimingPreference: '15min',
  restoreTimingPreference: '30min',
  createdAt: 2025-06-10T01:25:14.797Z,
  updatedAt: 2025-07-12T18:32:09.338Z
}
User timing preferences: { hideTimingPreference: '15min', restoreTimingPreference: '30min' }
User response being sent: {
  id: 'phtLx68scJszZOMrBEPHL',
  email: 'yk@gmail.com',
  username: 'yk',
  accountType: 'premium',
  shabbatCity: 'תל אביב',
  shabbatCityId: '531',
  hideTimingPreference: '15min',
  restoreTimingPreference: '30min',
  createdAt: 2025-06-10T01:25:14.797Z,
  updatedAt: 2025-07-12T18:32:09.338Z
}
7:57:55 PM [express] GET /api/user 304 in 43ms :: {"id":"phtLx68scJszZOMrBEPHL","email":"yk@gmail.co…
Auth middleware for GET /api/user/shabbat-location
Getting user for ID: phtLx68scJszZOMrBEPHL
Auth middleware for GET /api/auth-status
Getting user for ID: phtLx68scJszZOMrBEPHL
Raw secureUser from database: {
  id: 'phtLx68scJszZOMrBEPHL',
  email: 'yk@gmail.com',
  username: 'yk',
  passwordHash: '$2b$10$3EObo0LMRb0iu3/HAfCCOOXACLmDeU9wFIknjnRc/SRWzf8Q8fq7a',
  accountTier: 'premium',
  emailVerified: true,
  isActive: true,
  phoneNumber: null,
  phoneVerified: false,
  registrationMethod: 'email',
  shabbatCity: 'תל אביב',
  shabbatCityId: '531',
  hideTimingPreference: '15min',
  restoreTimingPreference: '30min',
  createdAt: 2025-06-10T01:25:14.797Z,
  updatedAt: 2025-07-12T18:32:09.338Z,
  lastLogin: 2025-06-27T12:09:46.135Z
}
Timing preferences from DB: { hideTimingPreference: '15min', restoreTimingPreference: '30min' }
User authenticated successfully: phtLx68scJszZOMrBEPHL
Raw secureUser from database: {
  id: 'phtLx68scJszZOMrBEPHL',
  email: 'yk@gmail.com',
  username: 'yk',
  passwordHash: '$2b$10$3EObo0LMRb0iu3/HAfCCOOXACLmDeU9wFIknjnRc/SRWzf8Q8fq7a',
  accountTier: 'premium',
  emailVerified: true,
  isActive: true,
  phoneNumber: null,
  phoneVerified: false,
  registrationMethod: 'email',
  shabbatCity: 'תל אביב',
  shabbatCityId: '531',
  hideTimingPreference: '15min',
  restoreTimingPreference: '30min',
  createdAt: 2025-06-10T01:25:14.797Z,
  updatedAt: 2025-07-12T18:32:09.338Z,
  lastLogin: 2025-06-27T12:09:46.135Z
}
Timing preferences from DB: { hideTimingPreference: '15min', restoreTimingPreference: '30min' }
User authenticated successfully: phtLx68scJszZOMrBEPHL
Getting Facebook auth for user in auth-status endpoint: phtLx68scJszZOMrBEPHL
About to call storage.getAuthToken...
🔍 Getting auth token for platform: facebook, userId: phtLx68scJszZOMrBEPHL
Raw secureUser from database: {
  id: 'phtLx68scJszZOMrBEPHL',
  email: 'yk@gmail.com',
  username: 'yk',
  passwordHash: '$2b$10$3EObo0LMRb0iu3/HAfCCOOXACLmDeU9wFIknjnRc/SRWzf8Q8fq7a',
  accountTier: 'premium',
  emailVerified: true,
  isActive: true,
  phoneNumber: null,
  phoneVerified: false,
  registrationMethod: 'email',
  shabbatCity: 'תל אביב',
  shabbatCityId: '531',
  hideTimingPreference: '15min',
  restoreTimingPreference: '30min',
  createdAt: 2025-06-10T01:25:14.797Z,
  updatedAt: 2025-07-12T18:32:09.338Z,
  lastLogin: 2025-06-27T12:09:46.135Z
}
Timing preferences from DB: { hideTimingPreference: '15min', restoreTimingPreference: '30min' }
User phtLx68scJszZOMrBEPHL location data: { shabbatCity: 'תל אביב', shabbatCityId: '531' }
7:57:56 PM [express] GET /api/user/shabbat-location 304 in 78ms :: {"shabbatCity":"תל אביב","shabbat…
📝 Query result for facebook/phtLx68scJszZOMrBEPHL: false
📝 No token found - checking if any records exist in table...
📝 Total tokens in table: 1
📝 Sample tokens: [
  {
    platform: 'youtube',
    userId: 'phtLx68scJszZOMrBEPHL',
    createdAt: 2025-07-15T18:51:01.020Z
  }
]
Storage.getAuthToken completed
Auth result in auth-status endpoint: false
Auth object details: null
Raw secureUser from database: {
  id: 'phtLx68scJszZOMrBEPHL',
  email: 'yk@gmail.com',
  username: 'yk',
  passwordHash: '$2b$10$3EObo0LMRb0iu3/HAfCCOOXACLmDeU9wFIknjnRc/SRWzf8Q8fq7a',
  accountTier: 'premium',
  emailVerified: true,
  isActive: true,
  phoneNumber: null,