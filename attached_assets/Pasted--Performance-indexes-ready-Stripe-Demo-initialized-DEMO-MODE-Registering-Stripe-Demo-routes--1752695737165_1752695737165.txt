
Performance indexes ready
Stripe Demo initialized (DEMO MODE)
Registering Stripe Demo routes...
Demo: Reset trial status and subscription for legacy user phtLx68scJszZOMrBEPHL
Reset trial status for legacy user phtLx68scJszZOMrBEPHL
âœ… Stripe Demo routes registered successfully
ğŸ¤– Starting automatic scheduler on server startup...
ğŸš€ Starting Automatic Shabbat Content Scheduler...
ğŸ“‹ Found 5 total users
ğŸ‘‘ Found 2 premium users
âš ï¸ No Shabbat times found for user yy@gmail.com
ğŸŒ Fetching Shabbat times for ×ª×œ ××‘×™×‘ (531) using HebCal API (fallback)
ğŸ“¡ Calling HebCal API: https://www.hebcal.com/shabbat?cfg=json&geonameid=293397&date=2025-07-18
Database migration status: {
  secure_users: '5',
  encrypted_auth_tokens: '1',
  video_lock_statuses: '5',
  video_statuses: '1'
}
Enhanced storage ready
âœ… Got HebCal times for ×ª×œ ××‘×™×‘: Entry 16:28, Exit 17:27
â° User yk@gmail.com scheduling:
        ğŸ•¯ï¸ Shabbat entry: 18.7.2025, 16:28:00
        âœ¨ Shabbat exit: 19.7.2025, 17:27:00
        ğŸ“± Hide preference: 15min â†’ Hide at: 18.7.2025, 16:13:00
        ğŸ”“ Restore preference: 30min â†’ Restore at: 19.7.2025, 17:57:00
ğŸ“… Scheduling cron job for: 18.7.2025, 16:13:00 (16:13)
â±ï¸ Creating cron job for 18.7.2025, 16:13:00 with pattern: 13 16 18 7 *
ğŸ“… Scheduling cron job for: 19.7.2025, 17:57:00 (17:57)
â±ï¸ Creating cron job for 19.7.2025, 17:57:00 with pattern: 57 17 19 7 *
âœ… Scheduled 2 operations for yk@gmail.com
âœ… Scheduled jobs for 2 premium users
âœ… Automatic Scheduler started successfully
ğŸ¤– Automatic scheduler started successfully
7:54:40 PM [express] serving on port 5000
Browserslist: browsers data (caniuse-lite) is 9 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
7:54:45 PM [express] GET /api/user 401 in 2ms :: {"error":"Not authenticated"}
Raw secureUser from database: {
  id: 'phtLx68scJszZOMrBEPHL',
  email: 'yk@gmail.com',
  username: 'yk',
  passwordHash: '$2b$10$3EObo0LMRb0iu3/HAfCCOOXACLmDeU9wFIknjnRc/SRWzf8Q8fq7a',
  accountTier: 'premium',
  emailVerified: true,
  isActive: true,
  phoneNumber: null,
  phoneVerified: false,
  registrationMethod: 'email',
  shabbatCity: '×ª×œ ××‘×™×‘',
  shabbatCityId: '531',
  hideTimingPreference: '15min',
  restoreTimingPreference: '30min',
  createdAt: 2025-06-10T01:25:14.797Z,
  updatedAt: 2025-07-12T18:32:09.338Z,
  lastLogin: 2025-06-27T12:09:46.135Z
}
Timing preferences from DB: { hideTimingPreference: '15min', restoreTimingPreference: '30min' }
Full user from database: {
  id: 'phtLx68scJszZOMrBEPHL',
  email: 'yk@gmail.com',
  username: 'yk',
  password: '$2b$10$3EObo0LMRb0iu3/HAfCCOOXACLmDeU9wFIknjnRc/SRWzf8Q8fq7a',
  accountType: 'premium',
  shabbatCity: '×ª×œ ××‘×™×‘',
  shabbatCityId: '531',
  hideTimingPreference: '15min',
  restoreTimingPreference: '30min',
  createdAt: 2025-06-10T01:25:14.797Z,
  updatedAt: 2025-07-12T18:32:09.338Z
}
User timing preferences: { hideTimingPreference: '15min', restoreTimingPreference: '30min' }
User response being sent: {
  id: 'phtLx68scJszZOMrBEPHL',
  email: 'yk@gmail.com',
  username: 'yk',
  accountType: 'premium',
  shabbatCity: '×ª×œ ××‘×™×‘',
  shabbatCityId: '531',
  hideTimingPreference: '15min',
  restoreTimingPreference: '30min',
  createdAt: 2025-06-10T01:25:14.797Z,
  updatedAt: 2025-07-12T18:32:09.338Z
}
7:54:47 PM [express] GET /api/user 304 in 44ms :: {"id":"phtLx68scJszZOMrBEPHL","email":"yk@gmail.coâ€¦
Auth middleware for GET /api/user/shabbat-location
Getting user for ID: phtLx68scJszZOMrBEPHL
Auth middleware for GET /api/auth-status
Getting user for ID: phtLx68scJszZOMrBEPHL
Raw secureUser from database: {
  id: 'phtLx68scJszZOMrBEPHL',
  email: 'yk@gmail.com',
  username: 'yk',
  passwordHash: '$2b$10$3EObo0LMRb0iu3/HAfCCOOXACLmDeU9wFIknjnRc/SRWzf8Q8fq7a',
  accountTier: 'premium',
  emailVerified: true,
  isActive: true,
  phoneNumber: null,
  phoneVerified: false,
  registrationMethod: 'email',
  shabbatCity: '×ª×œ ××‘×™×‘',
  shabbatCityId: '531',
  hideTimingPreference: '15min',
  restoreTimingPreference: '30min',
  createdAt: 2025-06-10T01:25:14.797Z,
  updatedAt: 2025-07-12T18:32:09.338Z,
  lastLogin: 2025-06-27T12:09:46.135Z
}
Timing preferences from DB: { hideTimingPreference: '15min', restoreTimingPreference: '30min' }
Full user from database: {
  id: 'phtLx68scJszZOMrBEPHL',
  email: 'yk@gmail.com',
  username: 'yk',
  password: '$2b$10$3EObo0LMRb0iu3/HAfCCOOXACLmDeU9wFIknjnRc/SRWzf8Q8fq7a',
  accountType: 'premium',
  shabbatCity: '×ª×œ ××‘×™×‘',
  shabbatCityId: '531',
  hideTimingPreference: '15min',
  restoreTimingPreference: '30min',
  createdAt: 2025-06-10T01:25:14.797Z,
  updatedAt: 2025-07-12T18:32:09.338Z
}
User timing preferences: { hideTimingPreference: '15min', restoreTimingPreference: '30min' }
User response being sent: {
  id: 'phtLx68scJszZOMrBEPHL',
  email: 'yk@gmail.com',
  username: 'yk',
  accountType: 'premium',
  shabbatCity: '×ª×œ ××‘×™×‘',
  shabbatCityId: '531',
  hideTimingPreference: '15min',
  restoreTimingPreference: '30min',
  createdAt: 2025-06-10T01:25:14.797Z,
  updatedAt: 2025-07-12T18:32:09.338Z
}
7:54:47 PM [express] GET /api/user 304 in 39ms :: {"id":"phtLx68scJszZOMrBEPHL","email":"yk@gmail.coâ€¦
Raw secureUser from database: {
  id: 'phtLx68scJszZOMrBEPHL',
  email: 'yk@gmail.com',
  username: 'yk',
  passwordHash: '$2b$10$3EObo0LMRb0iu3/HAfCCOOXACLmDeU9wFIknjnRc/SRWzf8Q8fq7a',
  accountTier: 'premium',
  emailVerified: true,
  isActive: true,
  phoneNumber: null,
  phoneVerified: false,
  registrationMethod: 'email',
  shabbatCity: '×ª×œ ××‘×™×‘',
  shabbatCityId: '531',
  hideTimingPreference: '15min',
  restoreTimingPreference: '30min',
  createdAt: 2025-06-10T01:25:14.797Z,
  updatedAt: 2025-07-12T18:32:09.338Z,
  lastLogin: 2025-06-27T12:09:46.135Z
}
Timing preferences from DB: { hideTimingPreference: '15min', restoreTimingPreference: '30min' }
User authenticated successfully: phtLx68scJszZOMrBEPHL
Raw secureUser from database: {
  id: 'phtLx68scJszZOMrBEPHL',
  email: 'yk@gmail.com',
  username: 'yk',
  passwordHash: '$2b$10$3EObo0LMRb0iu3/HAfCCOOXACLmDeU9wFIknjnRc/SRWzf8Q8fq7a',
  accountTier: 'premium',
  emailVerified: true,
  isActive: true,
  phoneNumber: null,
  phoneVerified: false,
  registrationMethod: 'email',
  shabbatCity: '×ª×œ ××‘×™×‘',
  shabbatCityId: '531',
  hideTimingPreference: '15min',
  restoreTimingPreference: '30min',
  createdAt: 2025-06-10T01:25:14.797Z,
  updatedAt: 2025-07-12T18:32:09.338Z,
  lastLogin: 2025-06-27T12:09:46.135Z
}
Timing preferences from DB: { hideTimingPreference: '15min', restoreTimingPreference: '30min' }
User phtLx68scJszZOMrBEPHL location data: { shabbatCity: '×ª×œ ××‘×™×‘', shabbatCityId: '531' }
7:54:47 PM [express] GET /api/user/shabbat-location 304 in 82ms :: {"shabbatCity":"×ª×œ ××‘×™×‘","shabbatâ€¦
Raw secureUser from database: {
  id: 'phtLx68scJszZOMrBEPHL',
  email: 'yk@gmail.com',
  username: 'yk',
  passwordHash: '$2b$10$3EObo0LMRb0iu3/HAfCCOOXACLmDeU9wFIknjnRc/SRWzf8Q8fq7a',
  accountTier: 'premium',
  emailVerified: true,
  isActive: true,
  phoneNumber: null,
  phoneVerified: false,
  registrationMethod: 'email',